

<h1><% @open_orders %> </h1>	

<div class="grid-container grid-title">
	
	<div class="grid-item"> <h2>Orders </h2> </div>	
	<div class="grid-item"> <h2>Booking ID</h2> </div>	
	<div class="grid-item"> <h2>Booker</h2> </div>
	<div class="grid-item"> <h2>Attendees</h2> </div>
	<div class="grid-item"> <h2>Ordered</h2> </div>
	<div class="grid-item"> <h2>Orders</h2> </div>
	<div class="grid-item"> <h2>Time since order</h2> </div>
	<div class="grid-item"> <h2>Bill value</h2> </div>
	<div class="grid-item"> <h2>Payment status</h2> </div>

</div>

	<div class="grid-container"> 

		<% @open_orders.each do |booking_id, attendee| %>

			<% booking = Booking.find(booking_id) %>

			<div class="grid-item">  <i class="fas fa-plus-circle"></i></div>	
			<div class="grid-item">  <%= booking.id %>  </div>	
			<div class="grid-item">  <%= booking.user.first_name %></div>
			<div class="grid-item">  <%= booking.attendees.count %></div>
			<div class="grid-item">  <%= booking.ordered %></div>
			<div class="grid-item">  <%= booking.orders.count %></div>

<!-- 		Time since ordering calculation based on time first order placed
 -->
 			<% @orders_in_booking = booking.orders %>
 			<% @orders_in_booking = @orders_in_booking.sort_by { |order| order.created_at } %> 
			<div class="grid-item">  
				<% if @orders_in_booking == nil %>
					Not ordered
				<% else %>
					<% time_now = DateTime.now.utc %>
					<% order_time = @orders_in_booking.first.created_at.utc%>
					<% elapsed_time = ((time_now - order_time ) / 1.minutes).to_i %>

					<% if elapsed_time > 60 %>
						<p class="over-an-hour"><%= number_with_delimiter(elapsed_time, :delimiter => ',') %> minutes 
					<% else %>
						<%= elapsed_time %> minutes
					<% end %>
				<% end %>
			</div>

<!-- 		Calculation of bill price
 -->
<!-- 		number_to_currency order.total_price 
 -->
			<% total_bill = @orders_in_booking.sum {|order| order.price} %> 
			<% total_bill = '%.2f' % total_bill %>
			<div class="grid-item"> <%= humanized_money_with_symbol(total_bill) %> </div>

			<div class="grid-item">  
				<% if booking.attendees.all? {|attendee| attendee.payment == true} %>
					Paid
				<% else %>
					Unpaid
				<% end %>
			</div>

		<% end %>
	
	</div>


		<!-- <div class> 
			<% @open_orders.each do |booking_id, attendee| %>

				<% booking = Booking.find(booking_id) %>
				<div class="admin-dash-columns"> 
					<p> <%= booking.id %> </p>
					<p> <%= booking.user.first_name %> </p>
					<p> <%= booking.attendees.count %> </p>
					<p> <%= booking.open %></p>
					<p> <%= booking.checkedin %></p>
					<p> ££tbc </p>
				</div>
				<% end %>
		</div> -->


</div>