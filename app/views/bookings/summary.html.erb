
<%  @page_title = "Table Order" %>

<!-- Conditional formatting of the tab buttons -->
<% content_for(:tab_table_class, "tab_table_active") %>
<!-- end -->

<div class="table-header">
  <h1><%= @restaurant.name %></h1>
  <p class="blue-font">Table opened on <%= @booking.date.to_s(:table_time) %></p>
</div>

<% @attendees.each do |attendee| %>

  <div class="card-order-container">

    <div class="card-order-summary">
      <h3><%= attendee.user.first_name %>'s order</h3>
    </div>

    <% attendee.orders.each do |order|  %>

      <div class="card-box-shadow card-small card-order">
        <div class="card-medium-img">
          <%= cl_image_tag(order.dish.photo,width: 400, height: 300, crop: :fill) %>
        </div>
        <div class="card-large-content">
          <h3><%= order.dish.name %></h3>
          <div class="flex-between">
            <p>Quantity: 1</p>
            <p><%= humanized_money_with_symbol(order.dish.price) %></p>
            <p><i class="far fa-clock"></i> <%= order.dish.prep_time %></p>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% end %>






<%#= if not everyone has ordered then grey out %>

<div class="button-area">
  <% if @booking.ordered == true %>

    <%= form_tag restaurant_booking_pay_path(@restaurant, @booking) do %>
    <article>
        <label class="amount">
          <h2><span>Amount: <strong><%= humanized_money_with_symbol(@order_total.to_f) %></span></h2></label></strong>
    </article>

    <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
      data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
      data-name="Table bill"
      data-email="<%= current_user.email %>"
      data-description="Pay Your Bill"
      data-amount="<%= @order_total * 100 %>"
      data-currency="GBP"></script>


    <% end %>

  <% else %>

    <%= simple_form_for [@restaurant, @booking] do |f| %>
      <%= f.input :ordered, as: :hidden, value: true %>
      <%= f.submit "Place table order", class: "button button-long" %>
      flash[:alert] = "Your table's order has been sent to the kitchen"
    <% end %>


  <% end %>

</div>








